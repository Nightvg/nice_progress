<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <title>Task Progress</title>
</head>
<body>

<div class="container mt-5">
  <h1 class="text-center">Task Progress</h1>

  <div class="row">
    <div class="col-lg-4 task-info-column border" id="leftTaskColumn">
      <!-- Tasks information will be displayed here -->
    </div>
    <div class="col-lg-4 progress-column border">
      <div class="progress vertical">
        <div id="taskProgressContainer" class="progress-bar-container">
          <!-- Each task progress bar will be appended here -->
        </div>
      </div>
    </div>
    <div class="col-lg-4 task-info-column border" id="rightTaskColumn">
      <!-- Tasks information will be displayed here -->
    </div>
  </div>

</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  function loadTasksProgress() {
    const row = document.getElementsByClassName('row')[0];
    const progressBarHeight = 300; // Height of each progress bar
    const emptyTaskInfo = document.createElement('div');
    emptyTaskInfo.classList.add('task-info-empty', 'm-3');
    emptyTaskInfo.style.height = `${progressBarHeight}px`;
    var taskProgressContainer = document.getElementById('taskProgressContainer');
    var leftTaskColumn = document.getElementById('leftTaskColumn');
    var progressBarContainer = taskProgressContainer.parentElement;
    var rightTaskColumn = document.getElementById('rightTaskColumn');
    taskProgressContainer.innerHTML = ''; // Clear previous content
    leftTaskColumn.innerHTML = ''; // Clear previous content
    rightTaskColumn.innerHTML = ''; // Clear previous content

    fetch('/loadTasks')
      .then(response => response.json())
      .then(tasks => {
        const totalTasks = tasks.length;

        taskProgressContainer.style.height = `${progressBarHeight*totalTasks}px`; // Set height of progress bar container
        progressBarContainer.style.height = `${progressBarHeight*totalTasks}px`; // Set height of progress bar container
        // Sort tasks by due date, empty due dates will be at the end
        tasks.sort((a, b) => {
          if (a.dueDate == '') {
            return 1;
          } else if (b.dueDate == '') {
            return -1;
          } else {
            return new Date(a.dueDate) - new Date(b.dueDate);
          }
        });

        tasks.forEach((task, index) => {
          const taskBarContainer = document.createElement('div');
          taskBarContainer.classList.add('task-bar-container', 'd-flex', 'align-items-center');
          taskBarContainer.style.height = `${progressBarHeight}px`;

          const progressBar = document.createElement('div');
          progressBar.classList.add('progress.vertical', 'mb-3');
          progressBar.style.width = '50px'; // Maximum width
          progressBar.style.height = '100%';

          const progressBarInner = document.createElement('div');
          progressBarInner.classList.add('progress-bar');
          progressBarInner.style.height = `${task.progress}%`; // Filling the progress bar
          progressBarInner.setAttribute('role', 'progressbar');
          progressBarInner.setAttribute('aria-valuenow', task.progress);
          progressBarInner.setAttribute('aria-valuemin', '0');
          progressBarInner.setAttribute('aria-valuemax', '100');

          // Color the progress bar based on average completion status
          if (task.progress == 100) {
            progressBarInner.classList.add('bg-success');
            console.log('success');
          } else {
            progressBarInner.classList.add('bg-info');
          }

          progressBar.appendChild(progressBarInner);
          taskBarContainer.appendChild(progressBar);

          const taskInfo = document.createElement('div');
          taskInfo.classList.add('task-info', 'm-3');
          taskInfo.innerHTML = `
            <div class="task-name">${task.headline}</div>
            <div class="due-date">${task.dueDate}</div>
            <div class="description">${task.description}</div>
          `;
          taskInfo.style.height = `${progressBarHeight}px`; // Equal height for each task info

          // Alternate between left and right columns
          if (index % 2 == 0) {
            leftTaskColumn.appendChild(taskInfo);
            rightTaskColumn.appendChild(emptyTaskInfo.cloneNode(true));
            console.log('even');
          } else {
            taskInfo.style.textAlign = 'right';
            rightTaskColumn.appendChild(taskInfo);
            leftTaskColumn.appendChild(emptyTaskInfo.cloneNode(true));
            console.log('odd');
          }

          taskProgressContainer.appendChild(taskBarContainer);
        });
      })
      .catch(error => console.error('Error:', error));
  }

  document.addEventListener("DOMContentLoaded", function() {
    loadTasksProgress(); // Initial loading of task progress bars
  });
</script>

<style>
  .progress.vertical {
    height: 100%;
    margin-bottom: 100px;
  }

  .task-bar-container {
    width: 100%;
  }

  .progress-bar {
    margin-right: auto;
    margin-left: auto;
  }

  .task-info {
    flex-shrink: 0;
  }

  .task-name {
    font-weight: bold;
  }

  .due-date {
    color: #6c757d; /* Bootstrap's secondary text color */
  }

  .progress-column {
    max-width: 50px;
  }

  
</style>

</body>
</html>
