<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <title>Task Editor</title>
</head>
<body>

<div class="container mt-5">
  <h1>Task Editor</h1>

  <form id="taskForm">
    <div class="form-group">
      <label for="headline">Headline:</label>
      <input type="text" class="form-control" id="headline" required>
    </div>
    <div class="form-group">
      <label for="dueDate">Due Date:</label>
      <input type="date" class="form-control" id="dueDate" required>
    </div>
    <div class="form-group">
      <label for="progress">Progress:</label>
      <input type="number" class="form-control" id="progress" min="0" max="100" required>
    </div>
    <div class="form-group">
      <label for="description">Description:</label>
      <textarea class="form-control" id="description" rows="3" required></textarea>
    </div>
    <button type="button" class="btn btn-primary" onclick="saveTask()">Save Task</button>

    <div class="mt-3">
      <label for="taskIdDropdown">Select Task:</label>
      <select class="form-control" id="taskIdDropdown" onchange="loadSelectedTask()">
        <option value="">Select a task to load</option>
      </select>
      <button type="button" class="btn btn-secondary mt-2" onclick="loadTask()">Load</button>
    </div>
  </form>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  function saveTask() {
    const taskId = document.getElementById('taskIdDropdown').value;
    const headline = document.getElementById('headline').value;
    const dueDate = document.getElementById('dueDate').value;
    const progress = document.getElementById('progress').value;
    const description = document.getElementById('description').value;

    if (taskId) {
      // If taskId is present, update existing task
      fetch(`/updateTask/${taskId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ taskId, headline, dueDate, progress, description }),
      })
      .then(response => response.text())
      .then(message => {
        alert(message);
        loadTasksDropdown();
      })
      .catch(error => console.error('Error:', error));
    } else {
      // If taskId is not present, save a new task
      fetch('/saveTask', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ headline, dueDate, progress, description }),
      })
      .then(response => response.text())
      .then(message => {
        alert(message);
        document.getElementById('taskForm').reset();
        loadTasksDropdown();
      })
      .catch(error => console.error('Error:', error));
    }
  }

  function loadTasksDropdown() {
    const taskIdDropdown = document.getElementById('taskIdDropdown');
    taskIdDropdown.innerHTML = '<option value="">Select a task to load</option>';

    fetch('/loadTasks')
      .then(response => response.json())
      .then(tasks => {
        tasks.forEach(task => {
          const option = document.createElement('option');
          option.value = task.taskId;
          option.innerText = task.headline;
          taskIdDropdown.appendChild(option);
        });
      })
      .catch(error => console.error('Error:', error));
  }

  function loadTask() {
    const selectedTaskId = document.getElementById('taskIdDropdown').value;

    if (selectedTaskId) {
      fetch(`/tasks/${selectedTaskId}.json`)
        .then(response => response.json())
        .then(task => {
          document.getElementById('headline').value = task.headline;
          document.getElementById('dueDate').value = task.dueDate;
          document.getElementById('progress').value = task.progress;
          document.getElementById('description').value = task.description;
        })
        .catch(error => console.error('Error:', error));
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    loadTasksDropdown(); // Initial loading of tasks in the dropdown
  });
</script>

</body>
</html>
